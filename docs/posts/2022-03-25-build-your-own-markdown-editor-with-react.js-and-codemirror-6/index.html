<!doctype html><html lang=en data-palette=black data-mode=dark>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Build your own markdown editor with React.js and Codemirror 6 | 0xsuk's blog</title><script src=https://identity.netlify.com/v1/netlify-identity-widget.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NST1PH6052"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-NST1PH6052")</script><link rel=apple-touch-icon href=https://0xsuk.github.io/images/icons/icon-180x180.png sizes=180x180>
<link rel=icon href=https://0xsuk.github.io/images/icons/icon-32x32.png sizes=32x32 type=image/png>
<link rel=icon href=https://0xsuk.github.io/images/icons/icon-16x16.png sizes=16x16 type=image/png>
<link rel=icon href=https://0xsuk.github.io/images/icons/favicon.ico>
<link rel=manifest href=https://0xsuk.github.io/manifest.json>
<meta name=keywords content>
<meta name=description content><meta itemprop=name content="Build your own markdown editor with React.js and Codemirror 6">
<meta itemprop=description content="Hi suk here. This post explains how to create markdown editor/previewer with React.js / Codemirror 6. I&rsquo;m writing this down because I had to learn how to build markdown editor for my project (a desktop based headless CMS for markdown blogs). Hope this post helps someone like me.
Goal of this project We are going to create a simple markdown editor that works in your browser. If I write strings in markdown format in codemirror editor, React."><meta itemprop=datePublished content="2022-03-25T02:41:36+00:00">
<meta itemprop=dateModified content="2022-03-25T02:41:36+00:00">
<meta itemprop=wordCount content="1987"><meta itemprop=image content="https://0xsuk.github.io/uploads/2022-03-25-12-13-39.png">
<meta itemprop=keywords content="React.js,build-your-own-x,"><meta property="og:title" content="Build your own markdown editor with React.js and Codemirror 6">
<meta property="og:description" content="Hi suk here. This post explains how to create markdown editor/previewer with React.js / Codemirror 6. I&rsquo;m writing this down because I had to learn how to build markdown editor for my project (a desktop based headless CMS for markdown blogs). Hope this post helps someone like me.
Goal of this project We are going to create a simple markdown editor that works in your browser. If I write strings in markdown format in codemirror editor, React.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://0xsuk.github.io/posts/2022-03-25-build-your-own-markdown-editor-with-react.js-and-codemirror-6/"><meta property="og:image" content="https://0xsuk.github.io/uploads/2022-03-25-12-13-39.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-03-25T02:41:36+00:00">
<meta property="article:modified_time" content="2022-03-25T02:41:36+00:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://0xsuk.github.io/uploads/2022-03-25-12-13-39.png">
<meta name=twitter:title content="Build your own markdown editor with React.js and Codemirror 6">
<meta name=twitter:description content="Hi suk here. This post explains how to create markdown editor/previewer with React.js / Codemirror 6. I&rsquo;m writing this down because I had to learn how to build markdown editor for my project (a desktop based headless CMS for markdown blogs). Hope this post helps someone like me.
Goal of this project We are going to create a simple markdown editor that works in your browser. If I write strings in markdown format in codemirror editor, React.">
<meta name=twitter:site content="@0xsuk">
<meta name=robots content="index, follow"><meta itemprop=name content="Build your own markdown editor with React.js and Codemirror 6">
<meta itemprop=description content="Hi suk here. This post explains how to create markdown editor/previewer with React.js / Codemirror 6. I&rsquo;m writing this down because I had to learn how to build markdown editor for my project (a desktop based headless CMS for markdown blogs). Hope this post helps someone like me.
Goal of this project We are going to create a simple markdown editor that works in your browser. If I write strings in markdown format in codemirror editor, React."><meta itemprop=datePublished content="2022-03-25T02:41:36+00:00">
<meta itemprop=dateModified content="2022-03-25T02:41:36+00:00">
<meta itemprop=wordCount content="1987"><meta itemprop=image content="https://0xsuk.github.io/uploads/2022-03-25-12-13-39.png">
<meta itemprop=keywords content="React.js,build-your-own-x,"><meta property="og:title" content="Build your own markdown editor with React.js and Codemirror 6">
<meta property="og:description" content="Hi suk here. This post explains how to create markdown editor/previewer with React.js / Codemirror 6. I&rsquo;m writing this down because I had to learn how to build markdown editor for my project (a desktop based headless CMS for markdown blogs). Hope this post helps someone like me.
Goal of this project We are going to create a simple markdown editor that works in your browser. If I write strings in markdown format in codemirror editor, React.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://0xsuk.github.io/posts/2022-03-25-build-your-own-markdown-editor-with-react.js-and-codemirror-6/"><meta property="og:image" content="https://0xsuk.github.io/uploads/2022-03-25-12-13-39.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-03-25T02:41:36+00:00">
<meta property="article:modified_time" content="2022-03-25T02:41:36+00:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://0xsuk.github.io/uploads/2022-03-25-12-13-39.png">
<meta name=twitter:title content="Build your own markdown editor with React.js and Codemirror 6">
<meta name=twitter:description content="Hi suk here. This post explains how to create markdown editor/previewer with React.js / Codemirror 6. I&rsquo;m writing this down because I had to learn how to build markdown editor for my project (a desktop based headless CMS for markdown blogs). Hope this post helps someone like me.
Goal of this project We are going to create a simple markdown editor that works in your browser. If I write strings in markdown format in codemirror editor, React.">
<meta name=twitter:site content="@0xsuk">
<link rel=stylesheet href=https://0xsuk.github.io/css/main.min.239845ebcdf55d80533cc70a2fe96cc1a9d70410c9b478774bb3f19fc13eb4f5.css integrity="sha256-I5hF6831XYBTPMcKL+lswanXBBDJtHh3S7Pxn8E+tPU=" crossorigin=anonymous><link rel=stylesheet href=https://0xsuk.github.io/css/katex.min.d080a89e03e1eb850f547d835c186b4273f69879aa497eb8b0e88c1578bf1f0b.css integrity="sha256-0ICongPh64UPVH2DXBhrQnP2mHmqSX64sOiMFXi/Hws=" crossorigin=anonymous>
<link rel=stylesheet href=https://0xsuk.github.io/css/viewer.min.3d228794bcedbbfa0412beb8fbc1ec6973202945e42af7004f742a4d7bd620ab.css integrity="sha256-PSKHlLztu/oEEr64+8HsaXMgKUXkKvcAT3QqTXvWIKs=" crossorigin=anonymous></head>
<body><script>const items=['mode','palette'];items.forEach(function(a){const b=localStorage.getItem('hbs-'+a);b&&document.body.parentElement.setAttribute('data-'+a,b)})</script><header><nav class="navbar top-app-bar top-app-bar-expand-lg">
<div style=position:relative class=container>
<button style=position:absolute;top:6px class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<i class="fas fa-bars"></i>
</button><a class="navbar-brand flex-grow-1 flex-lg-grow-0 text-center text-lg-start mx-auto me-lg-3" href=https://0xsuk.github.io/>0xsuk's blog
</a>
<div class="offcanvas offcanvas-bottom surface" tabindex=-1 id=offcanvasSocialShare aria-labelledby=offcanvasSocialShare>
<div class=offcanvas-header>
<h3 class=offcanvas-title>Share</h3>
<button type=button class="btn btn-sm btn-outline-primary" data-bs-dismiss=offcanvas aria-label=Close>
<i class="fas fa-times"></i>
</button>
</div>
<div class=offcanvas-body>
<a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Twitter Share Button" target=_blank href="https://twitter.com/intent/tweet?title=Build%20your%20own%20markdown%20editor%20with%20React.js%20and%20Codemirror%206&url=https%3a%2f%2f0xsuk.github.io%2fposts%2f2022-03-25-build-your-own-markdown-editor-with-react.js-and-codemirror-6%2f">
<i class="fab fa-fw fa-twitter"></i> Twitter
</a>
<a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Facebook Share Button" target=_blank href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2f0xsuk.github.io%2fposts%2f2022-03-25-build-your-own-markdown-editor-with-react.js-and-codemirror-6%2f">
<i class="fab fa-fw fa-facebook-f"></i> Facebook
</a>
</div>
</div>
<div class="collapse navbar-collapse" tabindex=-1 id=navbarSupportedContent aria-labelledby=navbarSupportedContent>
<form class="search-bar my-1" action=https://0xsuk.github.io/search>
<div class="input-group input-group-sm">
<span class="btn btn-search disabled position-absolute left-0"><i class="fas fa-fw fa-search"></i></span>
<input class="form-control rounded-pill" name=q type=search aria-label=Search>
</div>
</form>
<ul class="navbar-nav ms-auto"><li class=nav-item>
<a class=nav-link href=https://0xsuk.github.io/series/>
<i class="fas fa-fw fa-columns"></i>Series
</a>
</li><li class=nav-item>
<a class=nav-link href=https://0xsuk.github.io/archives/>
<i class="fas fa-fw fa-file-archive"></i>Archives
</a>
</li><li class=nav-item>
<a class=nav-link href=https://0xsuk.github.io/categories/>
<i class="fas fa-fw fa-folder"></i>Categories
</a>
</li><li class=nav-item>
<a class=nav-link href=https://0xsuk.github.io/tags/>
<i class="fas fa-fw fa-tags"></i>Tags
</a>
</li></ul>
</div>
</div>
</nav>
</header>
<main role=main class=container>
<div class="row content">
<div class=col-lg-8>
<div class=container><nav class="row card component" aria-label=breadcrumb>
<div class=card-body>
<ol class=breadcrumb><li class=breadcrumb-item><a href=https://0xsuk.github.io/>Home</a></li><li class=breadcrumb-item><a href=https://0xsuk.github.io/posts/>Posts</a></li><li class="breadcrumb-item active">Build Your Own Markdown Editor With React.js and Codemirror 6</li></ol>
</div>
</nav><div class=post-panel-wrapper>
<div class="d-flex flex-column component rounded post-panel">
</div>
</div>
<article class="row card component mb-4 post">
<div class=card-header>
<h1 class="card-title post-title">Build Your Own Markdown Editor With React.js and Codemirror 6
</h1>
</div>
<div class=card-body><div class=post-meta>
<span class=post-date title="created on 2022-03-25 11:41:36.133 +0900 JST.">
Mar 25, 2022
</span><span class=post-reading-time>
10 min read
</span><span class=post-taxonomies><a href=https://0xsuk.github.io/categories/web-dev/ class="badge post-taxonomy">Web Dev</a><a href=https://0xsuk.github.io/tags/react.js/ class="badge post-taxonomy">React.js</a><a href=https://0xsuk.github.io/tags/build-your-own-x/ class="badge post-taxonomy">build-your-own-x</a></span>
</div>
<div class="post-content mb-3"><p>Hi suk here.
This post explains how to create markdown editor/previewer with React.js / Codemirror 6. I&rsquo;m writing this down because I had to learn how to build markdown editor for my project (<a href=https://github.com/0xsuk/agitcms target=_blank rel="noopener noreferrer">a desktop based headless CMS for markdown blogs</a>). Hope this post helps someone like me.</p>
<h2 id=goal-of-this-project>Goal of this project<a class="anchor ms-1" href=#goal-of-this-project><i class="fas fa-link"></i></a></h2>
<p>We are going to create a simple markdown editor that works in your browser. If I write strings in markdown format in codemirror editor, React.js reads it, parses it, and displays preview.</p>
<p>Github Link: <a href=https://github.com/0xsuk/byome target=_blank rel="noopener noreferrer">https://github.com/0xsuk/byome</a><br>
Demo: <a href=https://0xsuk.github.io/byome>https://0xsuk.github.io/byome</a></p>
<p>I recommend following this tutorial referencing the github code. <br>
If you are fast learner, just go to github repo and try understand the code. Most of it should make sense, except for scroll sync part, which I&rsquo;ll explain later.</p>
<p><img class=img-fluid alt=GIF src=https://user-images.githubusercontent.com/97814789/173233884-b99cd89d-8ba1-471b-ad01-29a35241937c.png loading=lazy>
</p>
<h2 id=setup>Setup<a class="anchor ms-1" href=#setup><i class="fas fa-link"></i></a></h2>
<p>We are going to use Create React App.
I created a starter for this tutorial, which is just a create-react-app with some useless files deleted and some npm packages installed.</p>
<p>packages I&rsquo;ve included:</p>
<ul>
<li>@codemirror/state</li>
<li>@codemirror/view</li>
<li>@codemirror/language</li>
<li>@codemirror/lang-markdown</li>
<li>@lezer/highlight</li>
<li>unified</li>
<li>remark-parses</li>
<li>remark-rehype</li>
<li>rehype-react</li>
<li>remark-gfm</li>
</ul>
<p>Seems a lot, but these packages are just an editor (codemirror) and a parser(unified, remark-*). I&rsquo;ll explain each package of the list later.</p>
<p>You can clone my &ldquo;setup&rdquo; branch of <a href=https://github.com/0xsuk/byome target=_blank rel="noopener noreferrer">Github repo</a> to clone a starter for this project.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>git clone -b setup git@github.com/0xsuk/byome.git
<span class=ln>2</span><span class=nb>cd</span> byome
<span class=ln>3</span>npm i
<span class=ln>4</span>npm start
</code></pre></div><p>It says Hello byome</p>
<p><img class=img-fluid alt src=https://0xsuk.github.io/uploads/2022-03-25-12-13-39.png loading=lazy width=402 height=93>
</p>
<h2 id=writing-code>Writing Code<a class="anchor ms-1" href=#writing-code><i class="fas fa-link"></i></a></h2>
<h3 id=managing-state>Managing state<a class="anchor ms-1" href=#managing-state><i class="fas fa-link"></i></a></h3>
<p>We are going to use useState to manage contents of markdown, namely doc.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=ln>1</span><span class=kd>function</span> <span class=nx>App</span><span class=p>()</span> <span class=p>{</span>
<span class=ln>2</span>  <span class=kr>const</span> <span class=p>[</span><span class=nx>doc</span><span class=p>,</span> <span class=nx>setDoc</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s2>&#34;# Hello byome&#34;</span><span class=p>);</span>
<span class=ln>3</span>
<span class=ln>4</span>  <span class=k>return</span> <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;{</span><span class=nx>doc</span><span class=p>}&lt;/</span><span class=nt>div</span><span class=p>&gt;;</span>
<span class=ln>5</span><span class=p>}</span>
</code></pre></div><h3 id=creating-previewer>Creating previewer<a class="anchor ms-1" href=#creating-previewer><i class="fas fa-link"></i></a></h3>
<p>If doc changes, we want to read it, parse it and display preview of it.</p>
<p>We&rsquo;re going to use npm package called unified.</p>
<p>unified is an interface for parsing, inspecting, transforming, and serializing content through syntax trees.</p>
<p>We parse <code>doc</code> using <code>unified</code> with some extensions, such as <code>remark-parse</code>, <code>remark-rehype</code>, <code>remark-gfm</code>, <code>rehype-react</code>.</p>
<p>As stated in <a href=https://github.com/unifiedjs/unified#description target=_blank rel="noopener noreferrer">https://github.com/unifiedjs/unified#description</a>, <code>unified</code> consists of three parts: parser, transformer, and compiler.</p>
<p>In our case, we want to parse <code>doc</code> to markdown syntax tree first. So we use remark-parse as a parser. We parse doc to syntax tree, so that transformers such as remark-gfm can figure out what to do.</p>
<p>Second, we want additional functionality to our parser. There&rsquo;s a remark plugin called <code>remark-gfm</code> for supporting GFM (autolink literals, footnotes, strikethrough, tables, tasklists), so we use this extension.</p>
<p>Third, we want to compile the syntax tree to React component. There&rsquo;s a package called <code>rehype-react</code>, which reads rehype (HTML) syntax tree and compiles it into react component. However, rehype-react is only compatible with rehype syntax. So we transform remark (Markdown) syntax to rehype (HTML) syntax using transformer called <code>remark-rehype</code>, and we compile rehype syntax to React component.</p>
<p>All of the process stated above can be written in simple code.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=ln>1</span><span class=kr>const</span> <span class=nx>md</span> <span class=o>=</span> <span class=nx>unified</span><span class=p>()</span>
<span class=ln>2</span>  <span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>remarkParse</span><span class=p>)</span>
<span class=ln>3</span>  <span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>remarkGfm</span><span class=p>)</span>
<span class=ln>4</span>  <span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>remarkRehype</span><span class=p>)</span>
<span class=ln>5</span>  <span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>rehypeReact</span><span class=p>,</span> <span class=p>{</span> <span class=nx>createElement</span><span class=p>,</span> <span class=nx>Fragment</span> <span class=p>})</span>
<span class=ln>6</span>  <span class=p>.</span><span class=nx>processSync</span><span class=p>(</span><span class=nx>doc</span><span class=p>).</span><span class=nx>result</span><span class=p>;</span>
</code></pre></div><p>At this point, App.jsx looks like this</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=ln> 1</span><span class=kr>import</span> <span class=p>{</span> <span class=nx>useState</span><span class=p>,</span> <span class=nx>createElement</span><span class=p>,</span> <span class=nx>Fragment</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span>
<span class=ln> 2</span><span class=kr>import</span> <span class=s2>&#34;./App.css&#34;</span><span class=p>;</span>
<span class=ln> 3</span><span class=kr>import</span> <span class=p>{</span> <span class=nx>unified</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;unified&#34;</span><span class=p>;</span>
<span class=ln> 4</span><span class=kr>import</span> <span class=nx>remarkParse</span> <span class=nx>from</span> <span class=s2>&#34;remark-parse/lib&#34;</span><span class=p>;</span>
<span class=ln> 5</span><span class=kr>import</span> <span class=nx>remarkGfm</span> <span class=nx>from</span> <span class=s2>&#34;remark-gfm&#34;</span><span class=p>;</span>
<span class=ln> 6</span><span class=kr>import</span> <span class=nx>remarkRehype</span> <span class=nx>from</span> <span class=s2>&#34;remark-rehype&#34;</span><span class=p>;</span>
<span class=ln> 7</span><span class=kr>import</span> <span class=nx>rehypeReact</span> <span class=nx>from</span> <span class=s2>&#34;rehype-react/lib&#34;</span><span class=p>;</span>
<span class=ln> 8</span>
<span class=ln> 9</span><span class=kd>function</span> <span class=nx>App</span><span class=p>()</span> <span class=p>{</span>
<span class=ln>10</span>  <span class=kr>const</span> <span class=p>[</span><span class=nx>doc</span><span class=p>,</span> <span class=nx>setDoc</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s2>&#34;# Hello byome&#34;</span><span class=p>);</span>
<span class=ln>11</span>
<span class=ln>12</span>  <span class=kr>const</span> <span class=nx>md</span> <span class=o>=</span> <span class=nx>unified</span><span class=p>()</span>
<span class=ln>13</span>    <span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>remarkParse</span><span class=p>)</span>
<span class=ln>14</span>    <span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>remarkGfm</span><span class=p>)</span>
<span class=ln>15</span>    <span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>remarkRehype</span><span class=p>)</span>
<span class=ln>16</span>    <span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>rehypeReact</span><span class=p>,</span> <span class=p>{</span> <span class=nx>createElement</span><span class=p>,</span> <span class=nx>Fragment</span> <span class=p>})</span>
<span class=ln>17</span>    <span class=p>.</span><span class=nx>processSync</span><span class=p>(</span><span class=nx>doc</span><span class=p>).</span><span class=nx>result</span><span class=p>;</span>
<span class=ln>18</span>
<span class=ln>19</span>  <span class=k>return</span> <span class=p>(</span>
<span class=ln>20</span>    <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=ln>21</span>      <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;{</span><span class=nx>doc</span><span class=p>}&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=ln>22</span>      <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;{</span><span class=nx>md</span><span class=p>}&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=ln>23</span>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=ln>24</span>  <span class=p>);</span>
<span class=ln>25</span><span class=p>}</span>
<span class=ln>26</span>
<span class=ln>27</span><span class=kr>export</span> <span class=k>default</span> <span class=nx>App</span><span class=p>;</span>
</code></pre></div><p>Whenever <code>doc</code> is updated, component is rerendered, generating new preview using <code>unified</code>.</p>
<p>And if we <code>npm start</code>, localhost:3000 shows</p>
<p><img class=img-fluid alt src=https://0xsuk.github.io/uploads/2022-03-25-12-45-53.png loading=lazy width=336 height=163>
</p>
<p>Seems it&rsquo;s working!</p>
<p>&ldquo;# Hello byome&rdquo; is successfully parsed into &lt;h1>Hello byome&lt;/h1></p>
<h3 id=creating-editor>Creating editor<a class="anchor ms-1" href=#creating-editor><i class="fas fa-link"></i></a></h3>
<p>We are goingt create a markdown editor using Codemirror 6.</p>
<p>Two major components of codemirror 6 is EditorState class and EditorView class. EditorState represents a state of editor, and EditorView wraps operation on <code>state</code>. The concept of <code>state</code> and <code>view</code> is explained in <a href=https://codemirror.net/docs/guide/ target=_blank rel="noopener noreferrer">official document</a> so take a look.</p>
<p>We create initial EditorState containing initial doc (&ldquo;Hello byome&rdquo;), as documented here <a href=https://codemirror.net/6/docs/ref/#state.EditorState%5ecreate target=_blank rel="noopener noreferrer">https://codemirror.net/6/docs/ref/#state.EditorState^create</a>.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=ln> 1</span><span class=kr>const</span> <span class=nx>startState</span> <span class=o>=</span> <span class=nx>EditorState</span><span class=p>.</span><span class=nx>create</span><span class=p>({</span>
<span class=ln> 2</span>  <span class=nx>doc</span><span class=p>,</span>
<span class=ln> 3</span>  <span class=nx>extensions</span><span class=o>:</span> <span class=p>[</span>
<span class=ln> 4</span>    <span class=nx>EditorView</span><span class=p>.</span><span class=nx>updateListener</span><span class=p>.</span><span class=k>of</span><span class=p>((</span><span class=nx>update</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
<span class=ln> 5</span>      <span class=k>if</span> <span class=p>(</span><span class=nx>update</span><span class=p>.</span><span class=nx>docChanged</span><span class=p>)</span> <span class=p>{</span>
<span class=ln> 6</span>        <span class=nx>setDoc</span><span class=p>(</span><span class=nx>update</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>doc</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
<span class=ln> 7</span>      <span class=p>}</span>
<span class=ln> 8</span>    <span class=p>}),</span>
<span class=ln> 9</span>  <span class=p>],</span>
<span class=ln>10</span><span class=p>});</span>
</code></pre></div><p>And we create new editor using EditorView class, as documented here <a href=https://codemirror.net/6/docs/ref/#view.EditorView.constructor target=_blank rel="noopener noreferrer">https://codemirror.net/6/docs/ref/#view.EditorView.constructor</a></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=ln>1</span><span class=k>new</span> <span class=nx>EditorView</span><span class=p>({</span>
<span class=ln>2</span>  <span class=nx>state</span><span class=o>:</span> <span class=nx>startState</span><span class=p>,</span>
<span class=ln>3</span>  <span class=nx>parent</span><span class=o>:</span> <span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>,</span>
<span class=ln>4</span><span class=p>});</span>
</code></pre></div><p>Where <code>ref</code> is a reference for editor DOM element.</p>
<p>We want to create new Editor only when ref gets attached, so we put them into useEffect</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=ln> 1</span><span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
<span class=ln> 2</span>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
<span class=ln> 3</span>  <span class=kr>const</span> <span class=nx>startState</span> <span class=o>=</span> <span class=nx>EditorState</span><span class=p>.</span><span class=nx>create</span><span class=p>({</span>
<span class=ln> 4</span>    <span class=nx>doc</span><span class=p>,</span>
<span class=ln> 5</span>    <span class=nx>extensions</span><span class=o>:</span> <span class=p>[</span>
<span class=ln> 6</span>      <span class=nx>EditorView</span><span class=p>.</span><span class=nx>updateListener</span><span class=p>.</span><span class=k>of</span><span class=p>((</span><span class=nx>update</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
<span class=ln> 7</span>        <span class=k>if</span> <span class=p>(</span><span class=nx>update</span><span class=p>.</span><span class=nx>changes</span><span class=p>)</span> <span class=p>{</span>
<span class=ln> 8</span>          <span class=nx>setDoc</span><span class=p>(</span><span class=nx>update</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>doc</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
<span class=ln> 9</span>        <span class=p>}</span>
<span class=ln>10</span>      <span class=p>}),</span>
<span class=ln>11</span>    <span class=p>],</span>
<span class=ln>12</span>  <span class=p>});</span>
<span class=ln>13</span>
<span class=ln>14</span>  <span class=k>new</span> <span class=nx>EditorView</span><span class=p>({</span>
<span class=ln>15</span>    <span class=nx>state</span><span class=o>:</span> <span class=nx>startState</span><span class=p>,</span>
<span class=ln>16</span>    <span class=nx>parent</span><span class=o>:</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;editor&#34;</span><span class=p>),</span>
<span class=ln>17</span>  <span class=p>});</span>
<span class=ln>18</span><span class=p>},</span> <span class=p>[</span><span class=nx>ref</span><span class=p>]);</span>
</code></pre></div><p>I put them into <code>useCodemirror.jsx</code> so that App.jsx remains clean.</p>
<p>Now App.jsx looks like this</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=ln> 1</span><span class=kr>import</span> <span class=p>{</span> <span class=nx>useState</span><span class=p>,</span> <span class=nx>createElement</span><span class=p>,</span> <span class=nx>Fragment</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span>
<span class=ln> 2</span><span class=kr>import</span> <span class=s2>&#34;./App.css&#34;</span><span class=p>;</span>
<span class=ln> 3</span><span class=kr>import</span> <span class=p>{</span> <span class=nx>unified</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;unified&#34;</span><span class=p>;</span>
<span class=ln> 4</span><span class=kr>import</span> <span class=nx>remarkParse</span> <span class=nx>from</span> <span class=s2>&#34;remark-parse/lib&#34;</span><span class=p>;</span>
<span class=ln> 5</span><span class=kr>import</span> <span class=nx>remarkGfm</span> <span class=nx>from</span> <span class=s2>&#34;remark-gfm&#34;</span><span class=p>;</span>
<span class=ln> 6</span><span class=kr>import</span> <span class=nx>remarkRehype</span> <span class=nx>from</span> <span class=s2>&#34;remark-rehype&#34;</span><span class=p>;</span>
<span class=ln> 7</span><span class=kr>import</span> <span class=nx>rehypeReact</span> <span class=nx>from</span> <span class=s2>&#34;rehype-react/lib&#34;</span><span class=p>;</span>
<span class=ln> 8</span><span class=kr>import</span> <span class=nx>useCodemirror</span> <span class=nx>from</span> <span class=s2>&#34;./useCodemirror&#34;</span><span class=p>;</span>
<span class=ln> 9</span>
<span class=ln>10</span><span class=kd>function</span> <span class=nx>App</span><span class=p>()</span> <span class=p>{</span>
<span class=ln>11</span>  <span class=kr>const</span> <span class=p>[</span><span class=nx>doc</span><span class=p>,</span> <span class=nx>setDoc</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s2>&#34;# Hello byome&#34;</span><span class=p>);</span>
<span class=ln>12</span>  <span class=kr>const</span> <span class=p>[</span><span class=nx>editorRef</span><span class=p>,</span> <span class=nx>editorView</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useCodemirror</span><span class=p>({</span> <span class=nx>initialDoc</span><span class=o>:</span> <span class=nx>doc</span><span class=p>,</span> <span class=nx>setDoc</span> <span class=p>});</span>
<span class=ln>13</span>
<span class=ln>14</span>  <span class=kr>const</span> <span class=nx>md</span> <span class=o>=</span> <span class=nx>unified</span><span class=p>()</span>
<span class=ln>15</span>    <span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>remarkParse</span><span class=p>)</span>
<span class=ln>16</span>    <span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>remarkGfm</span><span class=p>)</span>
<span class=ln>17</span>    <span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>remarkRehype</span><span class=p>)</span>
<span class=ln>18</span>    <span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>rehypeReact</span><span class=p>,</span> <span class=p>{</span> <span class=nx>createElement</span><span class=p>,</span> <span class=nx>Fragment</span> <span class=p>})</span>
<span class=ln>19</span>    <span class=p>.</span><span class=nx>processSync</span><span class=p>(</span><span class=nx>doc</span><span class=p>).</span><span class=nx>result</span><span class=p>;</span>
<span class=ln>20</span>
<span class=ln>21</span>  <span class=k>return</span> <span class=p>(</span>
<span class=ln>22</span>    <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=ln>23</span>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>editorRef</span><span class=p>}&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=ln>24</span>      <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;{</span><span class=nx>md</span><span class=p>}&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=ln>25</span>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=ln>26</span>  <span class=p>);</span>
<span class=ln>27</span><span class=p>}</span>
<span class=ln>28</span>
<span class=ln>29</span><span class=kr>export</span> <span class=k>default</span> <span class=nx>App</span><span class=p>;</span>
</code></pre></div><p>And useCodemirror.jsx</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=ln> 1</span><span class=kr>import</span> <span class=p>{</span> <span class=nx>useRef</span><span class=p>,</span> <span class=nx>useState</span><span class=p>,</span> <span class=nx>useEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span>
<span class=ln> 2</span><span class=kr>import</span> <span class=p>{</span> <span class=nx>EditorState</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;@codemirror/state&#34;</span><span class=p>;</span>
<span class=ln> 3</span><span class=kr>import</span> <span class=p>{</span>  <span class=nx>EditorView</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;@codemirror/view&#34;</span><span class=p>;</span>
<span class=ln> 4</span>
<span class=ln> 5</span><span class=kd>function</span> <span class=nx>useCodemirror</span><span class=p>({</span> <span class=nx>initialDoc</span><span class=p>,</span> <span class=nx>setDoc</span> <span class=p>})</span> <span class=p>{</span>
<span class=ln> 6</span>  <span class=kr>const</span> <span class=nx>ref</span> <span class=o>=</span> <span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=ln> 7</span>  <span class=kr>const</span> <span class=p>[</span><span class=nx>view</span><span class=p>,</span> <span class=nx>setView</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=ln> 8</span>
<span class=ln> 9</span>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
<span class=ln>10</span>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
<span class=ln>11</span>    <span class=kr>const</span> <span class=nx>startState</span> <span class=o>=</span> <span class=nx>EditorState</span><span class=p>.</span><span class=nx>create</span><span class=p>({</span>
<span class=ln>12</span>      <span class=nx>doc</span><span class=o>:</span> <span class=nx>initialDoc</span><span class=p>,</span>
<span class=ln>13</span>      <span class=nx>contentHeight</span><span class=o>:</span> <span class=s2>&#34;100%&#34;</span><span class=p>,</span>
<span class=ln>14</span>      <span class=nx>extensions</span><span class=o>:</span> <span class=p>[</span>
<span class=ln>15</span>        <span class=nx>EditorView</span><span class=p>.</span><span class=nx>updateListener</span><span class=p>.</span><span class=k>of</span><span class=p>((</span><span class=nx>update</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
<span class=ln>16</span>          <span class=k>if</span> <span class=p>(</span><span class=nx>update</span><span class=p>.</span><span class=nx>docChanged</span><span class=p>)</span> <span class=p>{</span>
<span class=ln>17</span>            <span class=nx>setDoc</span><span class=p>(</span><span class=nx>update</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>doc</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
<span class=ln>18</span>          <span class=p>}</span>
<span class=ln>19</span>        <span class=p>}),</span>
<span class=ln>20</span>      <span class=p>],</span>
<span class=ln>21</span>    <span class=p>});</span>
<span class=ln>22</span>
<span class=ln>23</span>    <span class=kr>const</span> <span class=nx>view</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EditorView</span><span class=p>({</span>
<span class=ln>24</span>      <span class=nx>state</span><span class=o>:</span> <span class=nx>startState</span><span class=p>,</span>
<span class=ln>25</span>      <span class=nx>parent</span><span class=o>:</span> <span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>,</span>
<span class=ln>26</span>    <span class=p>});</span>
<span class=ln>27</span>
<span class=ln>28</span>    <span class=nx>setView</span><span class=p>(</span><span class=nx>view</span><span class=p>);</span>
<span class=ln>29</span>  <span class=p>},</span> <span class=p>[</span><span class=nx>ref</span><span class=p>]);</span>
<span class=ln>30</span>
<span class=ln>31</span>  <span class=k>return</span> <span class=p>[</span><span class=nx>ref</span><span class=p>,</span> <span class=nx>view</span><span class=p>];</span>
<span class=ln>32</span><span class=p>}</span>
<span class=ln>33</span>
<span class=ln>34</span><span class=kr>export</span> <span class=k>default</span> <span class=nx>useCodemirror</span><span class=p>;</span>
</code></pre></div><p>And it works!</p>
<p><img class=img-fluid alt=GIF src=https://0xsuk.github.io/uploads/byome.gif loading=lazy width=322 height=228>
</p>
<h3 id=extending-editor-functionality>Extending Editor Functionality<a class="anchor ms-1" href=#extending-editor-functionality><i class="fas fa-link"></i></a></h3>
<p>From here we&rsquo;re going to dive a little bit deeper into extending editor functionality.</p>
<h4 id=adding-linenumber-gutter-highlighting-of-active-line--its-gutter-markdown-support-highlighting-of-headings-linewrapping>adding lineNumber, Gutter, highlighting of active line & its gutter, markdown support, highlighting of headings, lineWrapping<a class="anchor ms-1" href=#adding-linenumber-gutter-highlighting-of-active-line--its-gutter-markdown-support-highlighting-of-headings-linewrapping><i class="fas fa-link"></i></a></h4>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=ln> 1</span><span class=kr>import</span> <span class=p>{</span> <span class=nx>useRef</span><span class=p>,</span> <span class=nx>useState</span><span class=p>,</span> <span class=nx>useEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span>
<span class=ln> 2</span><span class=kr>import</span> <span class=p>{</span> <span class=nx>EditorState</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;@codemirror/state&#34;</span><span class=p>;</span>
<span class=ln> 3</span><span class=kr>import</span> <span class=p>{</span>
<span class=ln> 4</span>  <span class=nx>EditorView</span><span class=p>,</span>
<span class=ln> 5</span>  <span class=nx>lineNumbers</span><span class=p>,</span>
<span class=ln> 6</span>  <span class=nx>highlightActiveLine</span><span class=p>,</span>
<span class=ln> 7</span>  <span class=nx>highlightActiveLineGutter</span><span class=p>,</span>
<span class=ln> 8</span><span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;@codemirror/view&#34;</span><span class=p>;</span>
<span class=ln> 9</span><span class=kr>import</span> <span class=p>{</span> <span class=nx>markdown</span><span class=p>,</span> <span class=nx>markdownLanguage</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;@codemirror/lang-markdown&#34;</span><span class=p>;</span>
<span class=ln>10</span><span class=kr>import</span> <span class=p>{</span> <span class=nx>syntaxHighlighting</span><span class=p>,</span> <span class=nx>HighlightStyle</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;@codemirror/language&#34;</span><span class=p>;</span>
<span class=ln>11</span><span class=kr>import</span> <span class=p>{</span> <span class=nx>tags</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;@lezer/highlight&#34;</span><span class=p>;</span>
<span class=ln>12</span>
<span class=ln>13</span><span class=kr>const</span> <span class=nx>markdownHighlighting</span> <span class=o>=</span> <span class=nx>HighlightStyle</span><span class=p>.</span><span class=nx>define</span><span class=p>([</span>
<span class=ln>14</span>  <span class=p>{</span> <span class=nx>tag</span><span class=o>:</span> <span class=nx>tags</span><span class=p>.</span><span class=nx>heading1</span><span class=p>,</span> <span class=nx>fontSize</span><span class=o>:</span> <span class=s2>&#34;1.6em&#34;</span><span class=p>,</span> <span class=nx>fontWeight</span><span class=o>:</span> <span class=s2>&#34;bold&#34;</span> <span class=p>},</span>
<span class=ln>15</span>  <span class=p>{</span>
<span class=ln>16</span>    <span class=nx>tag</span><span class=o>:</span> <span class=nx>tags</span><span class=p>.</span><span class=nx>heading2</span><span class=p>,</span>
<span class=ln>17</span>    <span class=nx>fontSize</span><span class=o>:</span> <span class=s2>&#34;1.4em&#34;</span><span class=p>,</span>
<span class=ln>18</span>    <span class=nx>fontWeight</span><span class=o>:</span> <span class=s2>&#34;bold&#34;</span><span class=p>,</span>
<span class=ln>19</span>  <span class=p>},</span>
<span class=ln>20</span>  <span class=p>{</span>
<span class=ln>21</span>    <span class=nx>tag</span><span class=o>:</span> <span class=nx>tags</span><span class=p>.</span><span class=nx>heading3</span><span class=p>,</span>
<span class=ln>22</span>    <span class=nx>fontSize</span><span class=o>:</span> <span class=s2>&#34;1.2em&#34;</span><span class=p>,</span>
<span class=ln>23</span>    <span class=nx>fontWeight</span><span class=o>:</span> <span class=s2>&#34;bold&#34;</span><span class=p>,</span>
<span class=ln>24</span>  <span class=p>},</span>
<span class=ln>25</span><span class=p>]);</span>
<span class=ln>26</span>
<span class=ln>27</span><span class=kd>function</span> <span class=nx>useCodemirror</span><span class=p>({</span> <span class=nx>initialDoc</span><span class=p>,</span> <span class=nx>setDoc</span> <span class=p>})</span> <span class=p>{</span>
<span class=ln>28</span>  <span class=kr>const</span> <span class=nx>ref</span> <span class=o>=</span> <span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=ln>29</span>  <span class=kr>const</span> <span class=p>[</span><span class=nx>view</span><span class=p>,</span> <span class=nx>setView</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=ln>30</span>
<span class=ln>31</span>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
<span class=ln>32</span>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
<span class=ln>33</span>    <span class=kr>const</span> <span class=nx>startState</span> <span class=o>=</span> <span class=nx>EditorState</span><span class=p>.</span><span class=nx>create</span><span class=p>({</span>
<span class=ln>34</span>      <span class=nx>doc</span><span class=o>:</span> <span class=nx>initialDoc</span><span class=p>,</span>
<span class=ln>35</span>      <span class=nx>contentHeight</span><span class=o>:</span> <span class=s2>&#34;100%&#34;</span><span class=p>,</span>
<span class=ln>36</span>      <span class=nx>extensions</span><span class=o>:</span> <span class=p>[</span>
<span class=ln>37</span>        <span class=nx>lineNumbers</span><span class=p>(),</span>
<span class=ln>38</span>        <span class=nx>highlightActiveLine</span><span class=p>(),</span>
<span class=ln>39</span>        <span class=nx>highlightActiveLineGutter</span><span class=p>(),</span>
<span class=ln>40</span>        <span class=nx>markdown</span><span class=p>({</span>
<span class=ln>41</span>          <span class=nx>base</span><span class=o>:</span> <span class=nx>markdownLanguage</span><span class=p>,</span> <span class=c1>//Support GFM
</span><span class=ln>42</span><span class=c1></span>        <span class=p>}),</span>
<span class=ln>43</span>        <span class=nx>syntaxHighlighting</span><span class=p>(</span><span class=nx>markdownHighlighting</span><span class=p>),</span>
<span class=ln>44</span>        <span class=nx>EditorView</span><span class=p>.</span><span class=nx>lineWrapping</span><span class=p>,</span>
<span class=ln>45</span>        <span class=nx>EditorView</span><span class=p>.</span><span class=nx>updateListener</span><span class=p>.</span><span class=k>of</span><span class=p>((</span><span class=nx>update</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
<span class=ln>46</span>          <span class=k>if</span> <span class=p>(</span><span class=nx>update</span><span class=p>.</span><span class=nx>docChanged</span><span class=p>)</span> <span class=p>{</span>
<span class=ln>47</span>            <span class=nx>setDoc</span><span class=p>(</span><span class=nx>update</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>doc</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
<span class=ln>48</span>          <span class=p>}</span>
<span class=ln>49</span>        <span class=p>}),</span>
<span class=ln>50</span>      <span class=p>],</span>
<span class=ln>51</span>    <span class=p>});</span>
<span class=ln>52</span>
<span class=ln>53</span>    <span class=kr>const</span> <span class=nx>view</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EditorView</span><span class=p>({</span>
<span class=ln>54</span>      <span class=nx>state</span><span class=o>:</span> <span class=nx>startState</span><span class=p>,</span>
<span class=ln>55</span>      <span class=nx>parent</span><span class=o>:</span> <span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>,</span>
<span class=ln>56</span>    <span class=p>});</span>
<span class=ln>57</span>
<span class=ln>58</span>    <span class=nx>setView</span><span class=p>(</span><span class=nx>view</span><span class=p>);</span>
<span class=ln>59</span>  <span class=p>},</span> <span class=p>[</span><span class=nx>ref</span><span class=p>]);</span>
<span class=ln>60</span>
<span class=ln>61</span>  <span class=k>return</span> <span class=p>[</span><span class=nx>ref</span><span class=p>,</span> <span class=nx>view</span><span class=p>];</span>
<span class=ln>62</span><span class=p>}</span>
<span class=ln>63</span>
<span class=ln>64</span><span class=kr>export</span> <span class=k>default</span> <span class=nx>useCodemirror</span><span class=p>;</span>
</code></pre></div><h4 id=scroll-sync>scroll sync<a class="anchor ms-1" href=#scroll-sync><i class="fas fa-link"></i></a></h4>
<p>This is probably the most complicated part.<br>
Before implementing scroll sync, take a glance at our App.css file because scrollSync is a matter of styling.<br>
App.css</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=ln> 1</span><span class=o>*</span> <span class=p>{</span>
<span class=ln> 2</span>  <span class=k>box-sizing</span><span class=p>:</span> <span class=kc>border-box</span><span class=p>;</span>
<span class=ln> 3</span>  <span class=k>margin</span><span class=p>:</span> <span class=mi>0</span><span class=p>;</span>
<span class=ln> 4</span><span class=p>}</span>
<span class=ln> 5</span>  
<span class=ln> 6</span>
<span class=ln> 7</span><span class=p>#</span><span class=nn>root</span> <span class=p>{</span>
<span class=ln> 8</span>  <span class=k>height</span><span class=p>:</span> <span class=mi>100</span><span class=kt>vh</span><span class=p>;</span>
<span class=ln> 9</span>  <span class=k>overflow</span><span class=p>:</span> <span class=kc>hidden</span><span class=p>;</span>
<span class=ln>10</span><span class=p>}</span>
<span class=ln>11</span>
<span class=ln>12</span><span class=p>#</span><span class=nn>editor-wrapper</span> <span class=p>{</span>
<span class=ln>13</span>  <span class=k>height</span><span class=p>:</span> <span class=mi>100</span><span class=kt>%</span><span class=p>;</span>
<span class=ln>14</span>  <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
<span class=ln>15</span><span class=p>}</span>
<span class=ln>16</span>
<span class=ln>17</span>
<span class=ln>18</span><span class=p>#</span><span class=nn>markdown</span> <span class=p>{</span>
<span class=ln>19</span>  <span class=k>height</span><span class=p>:</span> <span class=mi>100</span><span class=kt>%</span><span class=p>;</span>
<span class=ln>20</span>  <span class=k>flex</span><span class=p>:</span> <span class=mi>0</span> <span class=mi>0</span> <span class=mi>50</span><span class=kt>%</span><span class=p>;</span>
<span class=ln>21</span>  <span class=k>padding</span><span class=p>:</span> <span class=mi>0</span> <span class=mi>12</span><span class=kt>px</span> <span class=mi>0</span> <span class=mi>0</span><span class=p>;</span>
<span class=ln>22</span>  <span class=k>overflow-y</span><span class=p>:</span> <span class=kc>auto</span><span class=p>;</span>
<span class=ln>23</span><span class=p>}</span>
<span class=ln>24</span><span class=p>#</span><span class=nn>preview</span> <span class=p>{</span>
<span class=ln>25</span>  <span class=k>font-size</span><span class=p>:</span> <span class=mi>14</span><span class=kt>px</span><span class=p>;</span> <span class=c>/*make it same as codemirror */</span>
<span class=ln>26</span>  <span class=k>height</span><span class=p>:</span> <span class=mi>100</span><span class=kt>%</span><span class=p>;</span>
<span class=ln>27</span>  <span class=k>flex</span><span class=p>:</span> <span class=mi>0</span> <span class=mi>0</span> <span class=mi>50</span><span class=kt>%</span><span class=p>;</span>
<span class=ln>28</span>  <span class=k>padding</span><span class=p>:</span> <span class=mi>0</span> <span class=mi>0</span> <span class=mi>0</span> <span class=mi>12</span><span class=kt>px</span><span class=p>;</span>
<span class=ln>29</span>  <span class=k>border-left</span><span class=p>:</span> <span class=kc>solid</span> <span class=mi>1</span><span class=kt>px</span> <span class=mh>#ddd</span><span class=p>;</span>
<span class=ln>30</span>  <span class=k>overflow-x</span><span class=p>:</span> <span class=kc>hidden</span><span class=p>;</span>
<span class=ln>31</span>  <span class=k>overflow-y</span><span class=p>:</span> <span class=kc>auto</span><span class=p>;</span>
<span class=ln>32</span><span class=p>}</span>
<span class=ln>33</span>
<span class=ln>34</span><span class=p>#</span><span class=nn>preview</span> <span class=o>*</span> <span class=p>{</span>
<span class=ln>35</span>  <span class=k>overflow-x</span><span class=p>:</span> <span class=kc>auto</span><span class=p>;</span>
<span class=ln>36</span><span class=p>}</span>
</code></pre></div><p>And here&rsquo;s App.jsx</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=ln>  1</span><span class=kr>import</span> <span class=p>{</span> <span class=nx>useState</span><span class=p>,</span> <span class=nx>createElement</span><span class=p>,</span> <span class=nx>Fragment</span><span class=p>,</span> <span class=nx>useRef</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span>
<span class=ln>  2</span><span class=kr>import</span> <span class=s2>&#34;./App.css&#34;</span><span class=p>;</span>
<span class=ln>  3</span><span class=kr>import</span> <span class=p>{</span> <span class=nx>unified</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;unified&#34;</span><span class=p>;</span>
<span class=ln>  4</span><span class=kr>import</span> <span class=nx>remarkParse</span> <span class=nx>from</span> <span class=s2>&#34;remark-parse/lib&#34;</span><span class=p>;</span>
<span class=ln>  5</span><span class=kr>import</span> <span class=nx>remarkGfm</span> <span class=nx>from</span> <span class=s2>&#34;remark-gfm&#34;</span><span class=p>;</span>
<span class=ln>  6</span><span class=kr>import</span> <span class=nx>remarkRehype</span> <span class=nx>from</span> <span class=s2>&#34;remark-rehype&#34;</span><span class=p>;</span>
<span class=ln>  7</span><span class=kr>import</span> <span class=nx>rehypeReact</span> <span class=nx>from</span> <span class=s2>&#34;rehype-react/lib&#34;</span><span class=p>;</span>
<span class=ln>  8</span><span class=kr>import</span> <span class=nx>useCodemirror</span> <span class=nx>from</span> <span class=s2>&#34;./useCodemirror&#34;</span><span class=p>;</span>
<span class=ln>  9</span><span class=kr>import</span> <span class=s2>&#34;github-markdown-css/github-markdown-light.css&#34;</span><span class=p>;</span>
<span class=ln> 10</span>
<span class=ln> 11</span><span class=kd>let</span> <span class=nx>treeData</span><span class=p>;</span>
<span class=ln> 12</span>
<span class=ln> 13</span><span class=kd>function</span> <span class=nx>App</span><span class=p>()</span> <span class=p>{</span>
<span class=ln> 14</span>  <span class=kr>const</span> <span class=p>[</span><span class=nx>doc</span><span class=p>,</span> <span class=nx>setDoc</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s2>&#34;# Hello byome&#34;</span><span class=p>);</span>
<span class=ln> 15</span>  <span class=kr>const</span> <span class=p>[</span><span class=nx>editorRef</span><span class=p>,</span> <span class=nx>editorView</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useCodemirror</span><span class=p>({</span> <span class=nx>initialDoc</span><span class=o>:</span> <span class=nx>doc</span><span class=p>,</span> <span class=nx>setDoc</span> <span class=p>});</span>
<span class=ln> 16</span>  <span class=kr>const</span> <span class=nx>mouseIsOn</span> <span class=o>=</span> <span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=ln> 17</span>
<span class=ln> 18</span>  <span class=kr>const</span> <span class=nx>defaultPlugin</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=nx>tree</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
<span class=ln> 19</span>    <span class=nx>treeData</span> <span class=o>=</span> <span class=nx>tree</span><span class=p>;</span> <span class=c1>//treeData length corresponds to previewer&#39;s childNodes length
</span><span class=ln> 20</span><span class=c1></span>    <span class=k>return</span> <span class=nx>tree</span><span class=p>;</span>
<span class=ln> 21</span>  <span class=p>};</span>
<span class=ln> 22</span>
<span class=ln> 23</span>  <span class=kr>const</span> <span class=nx>markdownElem</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;markdown&#34;</span><span class=p>);</span>
<span class=ln> 24</span>  <span class=kr>const</span> <span class=nx>previewElem</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;preview&#34;</span><span class=p>);</span>
<span class=ln> 25</span>
<span class=ln> 26</span>  <span class=kr>const</span> <span class=nx>computeElemsOffsetTop</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
<span class=ln> 27</span>    <span class=kd>let</span> <span class=nx>markdownChildNodesOffsetTopList</span> <span class=o>=</span> <span class=p>[];</span>
<span class=ln> 28</span>    <span class=kd>let</span> <span class=nx>previewChildNodesOffsetTopList</span> <span class=o>=</span> <span class=p>[];</span>
<span class=ln> 29</span>
<span class=ln> 30</span>    <span class=nx>treeData</span><span class=p>.</span><span class=nx>children</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>child</span><span class=p>,</span> <span class=nx>index</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
<span class=ln> 31</span>      <span class=k>if</span> <span class=p>(</span><span class=nx>child</span><span class=p>.</span><span class=nx>type</span> <span class=o>!==</span> <span class=s2>&#34;element&#34;</span> <span class=o>||</span> <span class=nx>child</span><span class=p>.</span><span class=nx>position</span> <span class=o>===</span> <span class=kc>undefined</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
<span class=ln> 32</span>
<span class=ln> 33</span>      <span class=kr>const</span> <span class=nx>pos</span> <span class=o>=</span> <span class=nx>child</span><span class=p>.</span><span class=nx>position</span><span class=p>.</span><span class=nx>start</span><span class=p>.</span><span class=nx>offset</span><span class=p>;</span>
<span class=ln> 34</span>      <span class=kr>const</span> <span class=nx>lineInfo</span> <span class=o>=</span> <span class=nx>editorView</span><span class=p>.</span><span class=nx>lineBlockAt</span><span class=p>(</span><span class=nx>pos</span><span class=p>);</span>
<span class=ln> 35</span>      <span class=kr>const</span> <span class=nx>offsetTop</span> <span class=o>=</span> <span class=nx>lineInfo</span><span class=p>.</span><span class=nx>top</span><span class=p>;</span>
<span class=ln> 36</span>      <span class=nx>markdownChildNodesOffsetTopList</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>offsetTop</span><span class=p>);</span>
<span class=ln> 37</span>      <span class=nx>previewChildNodesOffsetTopList</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span>
<span class=ln> 38</span>        <span class=nx>previewElem</span><span class=p>.</span><span class=nx>childNodes</span><span class=p>[</span><span class=nx>index</span><span class=p>].</span><span class=nx>offsetTop</span> <span class=o>-</span>
<span class=ln> 39</span>          <span class=nx>previewElem</span><span class=p>.</span><span class=nx>getBoundingClientRect</span><span class=p>().</span><span class=nx>top</span> <span class=c1>//offsetTop from the top of preview
</span><span class=ln> 40</span><span class=c1></span>      <span class=p>);</span>
<span class=ln> 41</span>    <span class=p>});</span>
<span class=ln> 42</span>
<span class=ln> 43</span>    <span class=k>return</span> <span class=p>[</span><span class=nx>markdownChildNodesOffsetTopList</span><span class=p>,</span> <span class=nx>previewChildNodesOffsetTopList</span><span class=p>];</span>
<span class=ln> 44</span>  <span class=p>};</span>
<span class=ln> 45</span>  <span class=kr>const</span> <span class=nx>handleMdScroll</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
<span class=ln> 46</span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>mouseIsOn</span><span class=p>.</span><span class=nx>current</span><span class=p>);</span>
<span class=ln> 47</span>    <span class=k>if</span> <span class=p>(</span><span class=nx>mouseIsOn</span><span class=p>.</span><span class=nx>current</span> <span class=o>!==</span> <span class=s2>&#34;markdown&#34;</span><span class=p>)</span> <span class=p>{</span>
<span class=ln> 48</span>      <span class=k>return</span><span class=p>;</span>
<span class=ln> 49</span>    <span class=p>}</span>
<span class=ln> 50</span>    <span class=kr>const</span> <span class=p>[</span><span class=nx>markdownChildNodesOffsetTopList</span><span class=p>,</span> <span class=nx>previewChildNodesOffsetTopList</span><span class=p>]</span> <span class=o>=</span>
<span class=ln> 51</span>      <span class=nx>computeElemsOffsetTop</span><span class=p>();</span>
<span class=ln> 52</span>    <span class=kd>let</span> <span class=nx>scrollElemIndex</span><span class=p>;</span>
<span class=ln> 53</span>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>markdownChildNodesOffsetTopList</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=nx>i</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
<span class=ln> 54</span>      <span class=k>if</span> <span class=p>(</span><span class=nx>markdownElem</span><span class=p>.</span><span class=nx>scrollTop</span> <span class=o>&lt;</span> <span class=nx>markdownChildNodesOffsetTopList</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span> <span class=p>{</span>
<span class=ln> 55</span>        <span class=nx>scrollElemIndex</span> <span class=o>=</span> <span class=nx>i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
<span class=ln> 56</span>        <span class=k>break</span><span class=p>;</span>
<span class=ln> 57</span>      <span class=p>}</span>
<span class=ln> 58</span>    <span class=p>}</span>
<span class=ln> 59</span>
<span class=ln> 60</span>    <span class=k>if</span> <span class=p>(</span>
<span class=ln> 61</span>      <span class=nx>markdownElem</span><span class=p>.</span><span class=nx>scrollTop</span> <span class=o>&gt;=</span>
<span class=ln> 62</span>      <span class=nx>markdownElem</span><span class=p>.</span><span class=nx>scrollHeight</span> <span class=o>-</span> <span class=nx>markdownElem</span><span class=p>.</span><span class=nx>clientHeight</span> <span class=c1>//true when scroll reached the bottom
</span><span class=ln> 63</span><span class=c1></span>    <span class=p>)</span> <span class=p>{</span>
<span class=ln> 64</span>      <span class=nx>previewElem</span><span class=p>.</span><span class=nx>scrollTop</span> <span class=o>=</span>
<span class=ln> 65</span>        <span class=nx>previewElem</span><span class=p>.</span><span class=nx>scrollHeight</span> <span class=o>-</span> <span class=nx>previewElem</span><span class=p>.</span><span class=nx>clientHeight</span><span class=p>;</span> <span class=c1>//scroll to the bottom
</span><span class=ln> 66</span><span class=c1></span>      <span class=k>return</span><span class=p>;</span>
<span class=ln> 67</span>    <span class=p>}</span>
<span class=ln> 68</span>
<span class=ln> 69</span>    <span class=k>if</span> <span class=p>(</span><span class=nx>scrollElemIndex</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
<span class=ln> 70</span>      <span class=kd>let</span> <span class=nx>ratio</span> <span class=o>=</span>
<span class=ln> 71</span>        <span class=p>(</span><span class=nx>markdownElem</span><span class=p>.</span><span class=nx>scrollTop</span> <span class=o>-</span>
<span class=ln> 72</span>          <span class=nx>markdownChildNodesOffsetTopList</span><span class=p>[</span><span class=nx>scrollElemIndex</span><span class=p>])</span> <span class=o>/</span>
<span class=ln> 73</span>        <span class=p>(</span><span class=nx>markdownChildNodesOffsetTopList</span><span class=p>[</span><span class=nx>scrollElemIndex</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span>
<span class=ln> 74</span>          <span class=nx>markdownChildNodesOffsetTopList</span><span class=p>[</span><span class=nx>scrollElemIndex</span><span class=p>]);</span>
<span class=ln> 75</span>      <span class=nx>previewElem</span><span class=p>.</span><span class=nx>scrollTop</span> <span class=o>=</span>
<span class=ln> 76</span>        <span class=nx>ratio</span> <span class=o>*</span>
<span class=ln> 77</span>          <span class=p>(</span><span class=nx>previewChildNodesOffsetTopList</span><span class=p>[</span><span class=nx>scrollElemIndex</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span>
<span class=ln> 78</span>            <span class=nx>previewChildNodesOffsetTopList</span><span class=p>[</span><span class=nx>scrollElemIndex</span><span class=p>])</span> <span class=o>+</span>
<span class=ln> 79</span>        <span class=nx>previewChildNodesOffsetTopList</span><span class=p>[</span><span class=nx>scrollElemIndex</span><span class=p>];</span>
<span class=ln> 80</span>    <span class=p>}</span>
<span class=ln> 81</span>  <span class=p>};</span>
<span class=ln> 82</span>
<span class=ln> 83</span>  <span class=kr>const</span> <span class=nx>handlePreviewScroll</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
<span class=ln> 84</span>    <span class=k>if</span> <span class=p>(</span><span class=nx>mouseIsOn</span><span class=p>.</span><span class=nx>current</span> <span class=o>!==</span> <span class=s2>&#34;preview&#34;</span><span class=p>)</span> <span class=p>{</span>
<span class=ln> 85</span>      <span class=k>return</span><span class=p>;</span>
<span class=ln> 86</span>    <span class=p>}</span>
<span class=ln> 87</span>    <span class=kr>const</span> <span class=p>[</span><span class=nx>markdownChildNodesOffsetTopList</span><span class=p>,</span> <span class=nx>previewChildNodesOffsetTopList</span><span class=p>]</span> <span class=o>=</span>
<span class=ln> 88</span>      <span class=nx>computeElemsOffsetTop</span><span class=p>();</span>
<span class=ln> 89</span>    <span class=kd>let</span> <span class=nx>scrollElemIndex</span><span class=p>;</span>
<span class=ln> 90</span>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>previewChildNodesOffsetTopList</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=nx>i</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
<span class=ln> 91</span>      <span class=k>if</span> <span class=p>(</span><span class=nx>previewElem</span><span class=p>.</span><span class=nx>scrollTop</span> <span class=o>&lt;</span> <span class=nx>previewChildNodesOffsetTopList</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span> <span class=p>{</span>
<span class=ln> 92</span>        <span class=nx>scrollElemIndex</span> <span class=o>=</span> <span class=nx>i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
<span class=ln> 93</span>        <span class=k>break</span><span class=p>;</span>
<span class=ln> 94</span>      <span class=p>}</span>
<span class=ln> 95</span>    <span class=p>}</span>
<span class=ln> 96</span>
<span class=ln> 97</span>    <span class=k>if</span> <span class=p>(</span><span class=nx>scrollElemIndex</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
<span class=ln> 98</span>      <span class=kd>let</span> <span class=nx>ratio</span> <span class=o>=</span>
<span class=ln> 99</span>        <span class=p>(</span><span class=nx>previewElem</span><span class=p>.</span><span class=nx>scrollTop</span> <span class=o>-</span>
<span class=ln>100</span>          <span class=nx>previewChildNodesOffsetTopList</span><span class=p>[</span><span class=nx>scrollElemIndex</span><span class=p>])</span> <span class=o>/</span>
<span class=ln>101</span>        <span class=p>(</span><span class=nx>previewChildNodesOffsetTopList</span><span class=p>[</span><span class=nx>scrollElemIndex</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span>
<span class=ln>102</span>          <span class=nx>previewChildNodesOffsetTopList</span><span class=p>[</span><span class=nx>scrollElemIndex</span><span class=p>]);</span>
<span class=ln>103</span>      <span class=nx>markdownElem</span><span class=p>.</span><span class=nx>scrollTop</span> <span class=o>=</span>
<span class=ln>104</span>        <span class=nx>ratio</span> <span class=o>*</span>
<span class=ln>105</span>          <span class=p>(</span><span class=nx>markdownChildNodesOffsetTopList</span><span class=p>[</span><span class=nx>scrollElemIndex</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span>
<span class=ln>106</span>            <span class=nx>markdownChildNodesOffsetTopList</span><span class=p>[</span><span class=nx>scrollElemIndex</span><span class=p>])</span> <span class=o>+</span>
<span class=ln>107</span>        <span class=nx>markdownChildNodesOffsetTopList</span><span class=p>[</span><span class=nx>scrollElemIndex</span><span class=p>];</span>
<span class=ln>108</span>    <span class=p>}</span>
<span class=ln>109</span>  <span class=p>};</span>
<span class=ln>110</span>
<span class=ln>111</span>  <span class=kr>const</span> <span class=nx>md</span> <span class=o>=</span> <span class=nx>unified</span><span class=p>()</span>
<span class=ln>112</span>    <span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>remarkParse</span><span class=p>)</span>
<span class=ln>113</span>    <span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>remarkGfm</span><span class=p>)</span>
<span class=ln>114</span>    <span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>remarkRehype</span><span class=p>)</span>
<span class=ln>115</span>    <span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>defaultPlugin</span><span class=p>)</span>
<span class=ln>116</span>    <span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>rehypeReact</span><span class=p>,</span> <span class=p>{</span> <span class=nx>createElement</span><span class=p>,</span> <span class=nx>Fragment</span> <span class=p>})</span>
<span class=ln>117</span>    <span class=p>.</span><span class=nx>processSync</span><span class=p>(</span><span class=nx>doc</span><span class=p>).</span><span class=nx>result</span><span class=p>;</span>
<span class=ln>118</span>
<span class=ln>119</span>  <span class=k>return</span> <span class=p>(</span>
<span class=ln>120</span>    <span class=p>&lt;&gt;</span>
<span class=ln>121</span>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;editor-wrapper&#34;</span><span class=p>&gt;</span>
<span class=ln>122</span>        <span class=p>&lt;</span><span class=nt>div</span>
<span class=ln>123</span>          <span class=na>id</span><span class=o>=</span><span class=s>&#34;markdown&#34;</span>
<span class=ln>124</span>          <span class=na>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>editorRef</span><span class=p>}</span>
<span class=ln>125</span>          <span class=na>onScroll</span><span class=o>=</span><span class=p>{</span><span class=nx>handleMdScroll</span><span class=p>}</span>
<span class=ln>126</span>          <span class=na>onMouseEnter</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=nx>mouseIsOn</span><span class=p>.</span><span class=nx>current</span> <span class=o>=</span> <span class=s2>&#34;markdown&#34;</span><span class=p>)}</span>
<span class=ln>127</span>        <span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=ln>128</span>        <span class=p>&lt;</span><span class=nt>div</span>
<span class=ln>129</span>          <span class=na>id</span><span class=o>=</span><span class=s>&#34;preview&#34;</span>
<span class=ln>130</span>          <span class=na>className</span><span class=o>=</span><span class=s>&#34;markdown-body&#34;</span>
<span class=ln>131</span>          <span class=na>onScroll</span><span class=o>=</span><span class=p>{</span><span class=nx>handlePreviewScroll</span><span class=p>}</span>
<span class=ln>132</span>          <span class=na>onMouseEnter</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=nx>mouseIsOn</span><span class=p>.</span><span class=nx>current</span> <span class=o>=</span> <span class=s2>&#34;preview&#34;</span><span class=p>)}</span>
<span class=ln>133</span>        <span class=p>&gt;</span>
<span class=ln>134</span>          <span class=p>{</span><span class=nx>md</span><span class=p>}</span>
<span class=ln>135</span>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=ln>136</span>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=ln>137</span>    <span class=p>&lt;/&gt;</span>
<span class=ln>138</span>  <span class=p>);</span>
<span class=ln>139</span><span class=p>}</span>
<span class=ln>140</span>
<span class=ln>141</span><span class=kr>export</span> <span class=k>default</span> <span class=nx>App</span><span class=p>;</span>
</code></pre></div><p>If scroll on <code>markdown</code> div is invoked, handleMdScroll() is called.</p>
<p><code>computeElemsOffsetTop()</code> computes offsetTop relative to <code>markdown</code> div&rsquo;s top for each element of <em>parsed</em> markdown (child of treeData, try console.logging treeData to better understand).</p>
<p>If any parsed markdown element&rsquo;s offsetTop is greater than scrollTop of <code>markdown</code> div, meaning the whole element is visible at the highest position in the visible area of editor, set scrollElemIndex to previous parsed markdown element (the one that is partially hidden above the visible area of editor).</p>
<p>Then set scrollTop of <code>preview</code> div to corresponding element&rsquo;s offsetTop relative to <code>preview</code> div, with proper additional value.</p>
<p>And vice versa for handling preview scroll.</p>
<p>Now our markdown editor finally looks like this</p>
<p><img class=img-fluid alt=GIF src=https://user-images.githubusercontent.com/97814789/173233884-b99cd89d-8ba1-471b-ad01-29a35241937c.png loading=lazy>
</p>
<p>pretty neat right?</p>
</div></div>
<div class=card-footer><div class="post-navs d-flex justify-content-evenly"><div class="post-nav post-prev">
<i class="fas fa-fw fa-chevron-left"></i>
<a href=https://0xsuk.github.io/posts/2022-02-11-creating-a-blog-with-hugo/>Creating a Blog With Hugo
</a>
</div><div class="post-nav post-next">
<a href=https://0xsuk.github.io/posts/2022-07-19-how-to-install-ch340-on-ubuntu-22.04/>How to Install CH340 on Ubuntu 22.04
</a>
<i class="fas fa-fw fa-chevron-right"></i>
</div></div></div>
</article><section class="related-posts row card component">
<div class=card-header>
<h2 class=card-title>Related Posts</h2>
</div>
<div class=card-body>
<ul class=post-list><li>
<a href=https://0xsuk.github.io/posts/2022-02-11-creating-a-blog-with-hugo/>Creating a Blog With Hugo
</a>
<span class="float-end post-date">Feb 11, 2022
</span>
</li></ul>
</div>
</section><div class="card component row post-comments" id=post-comments>
<div class=card-header>
<h2 class=card-title>Comments</h2>
</div>
<div class=card-body><script src=https://utteranc.es/client.js repo=0xsuk/0xsuk.github.io issue-term=pathname label=comment theme=github-light crossorigin=anonymous async></script></div>
</div></div>
</div><aside class="col-lg-4 sidebar d-flex">
<div class="container d-flex flex-column">
<section class="card row text-center profile component">
<div class=card-body>
<div class="col-12 d-flex align-items-center justify-content-center"><img class="profile-avatar rounded-circle" alt=0xsuk src=https://0xsuk.github.io/images/profile.png loading=lazy width=408 height=408>
</div>
<div class="col-12 profile-meta"><div class=profile-name>0xsuk</div><div class=profile-location><i class="fas fa-fw fa-map-marker-alt"></i>Japan</div><div class=profile-about><i class="fas fa-fw fa-user"></i><a href=https://0xsuk.github.io/about/>About</a></div><nav class="social-links nav justify-content-center"><a class="nav-link social-link" href=mailto:iam0xsuk@gmail.com title=Email>
<i class="fas fa-fw fa-2x fa-envelope"></i>
</a><a class="nav-link social-link" target=_blank href=https://github.com/0xsuk title=GitHub rel="noopener noreferrer">
<i class="fa-fw fa-2x fab fa-github"></i>
</a><a class="nav-link social-link" target=_blank href=https://twitter.com/0xsuk title=Twitter rel="noopener noreferrer">
<i class="fa-fw fa-2x fab fa-twitter"></i>
</a></nav>
</div>
</div>
</section>
<div class="post-toc row mb-4 card component" id=postTOC>
<div class=card-header>
<h2 class=card-title>Contents</h2>
</div>
<div class=card-body>
<nav id=TableOfContents>
<ul>
<li><a href=#goal-of-this-project>Goal of this project</a></li>
<li><a href=#setup>Setup</a></li>
<li><a href=#writing-code>Writing Code</a>
<ul>
<li><a href=#managing-state>Managing state</a></li>
<li><a href=#creating-previewer>Creating previewer</a></li>
<li><a href=#creating-editor>Creating editor</a></li>
<li><a href=#extending-editor-functionality>Extending Editor Functionality</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</div><section class="recent-posts row card component">
<div class=card-header>
<h2 class=card-title>Recent Posts</h2>
</div>
<div class=card-body>
<ul class=post-list><li>
<a href=https://0xsuk.github.io/posts/2022-07-19-how-to-install-ch340-on-ubuntu-22.04/>How to Install CH340 on Ubuntu 22.04
</a>
</li><li>
<a href=https://0xsuk.github.io/posts/2022-03-25-build-your-own-markdown-editor-with-react.js-and-codemirror-6/>Build Your Own Markdown Editor With React.js and Codemirror 6
</a>
</li><li>
<a href=https://0xsuk.github.io/posts/2022-02-11-creating-a-blog-with-hugo/>Creating a Blog With Hugo
</a>
</li></ul>
</div>
</section><section class="categories-taxonomies row card component">
<div class=card-header>
<h2 class=card-title>
<a href=https://0xsuk.github.io/categories>Categories</a>
</h2>
</div>
<div class=card-body>
<div class=py-2><a href=https://0xsuk.github.io/categories/web-dev/ class="badge rounded post-taxonomy" title="Web Dev">
Web Dev<span class="badge badge-sm text-white bg-accent ms-1">2</span></a><a href=https://0xsuk.github.io/categories/robotics/ class="badge rounded post-taxonomy" title=Robotics>
Robotics<span class="badge badge-sm text-white bg-accent ms-1">1</span></a></div>
</div>
</section><section class="tags-taxonomies row card component">
<div class=card-header>
<h2 class=card-title>
<a href=https://0xsuk.github.io/tags>Tags</a>
</h2>
</div>
<div class=card-body>
<div class=py-2><a href=https://0xsuk.github.io/tags/react.js/ class="badge rounded post-taxonomy" title=React.js>
React.js<span class="badge badge-sm text-white bg-accent ms-1">2</span></a><a href=https://0xsuk.github.io/tags/arduino/ class="badge rounded post-taxonomy" title=Arduino>
Arduino<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href=https://0xsuk.github.io/tags/build-your-own-x/ class="badge rounded post-taxonomy" title=build-your-own-x>
build-your-own-x<span class="badge badge-sm text-white bg-accent ms-1">1</span></a></div>
</div>
</section>
</div>
</aside>
</div>
</main><footer class="footer mt-auto py-3 text-center container"><nav class="social-links nav justify-content-center mb-2"><a class="nav-link social-link" href=mailto:iam0xsuk@gmail.com title=Email>
<i class="fas fa-fw fa-2x fa-envelope"></i>
</a><a class="nav-link social-link" target=_blank href=https://github.com/0xsuk title=GitHub rel="noopener noreferrer">
<i class="fa-fw fa-2x fab fa-github"></i>
</a><a class="nav-link social-link" target=_blank href=https://twitter.com/0xsuk title=Twitter rel="noopener noreferrer">
<i class="fa-fw fa-2x fab fa-twitter"></i>
</a></nav>
<div class="copyright mb-2">
Copyright  2022 0xsuk. All Rights Reserved.
</div>
</footer>
<script src=https://0xsuk.github.io/js/main.63de5e46379791c474cfb750221ee20c6c2b8cfcf2d28b115e7197b95b2f910b.js integrity="sha256-Y95eRjeXkcR0z7dQIh7iDGwrjPzy0osRXnGXuVsvkQs=" crossorigin=anonymous defer></script><script src=https://0xsuk.github.io/js/icons.min.8ddcaafc364ff0296c2209c5495287f0de039b852da9b24847f94c198b7639b6.js integrity="sha256-jdyq/DZP8ClsIgnFSVKH8N4Dm4UtqbJIR/lMGYt2ObY=" crossorigin=anonymous defer></script>
<script>'serviceWorker'in navigator&&window.addEventListener('load',()=>{navigator.serviceWorker.register('https://0xsuk.github.io/service-worker.js').then(function(a){console.log('Successfully registered service worker',a)}).catch(function(a){console.warn('Error whilst registering service worker',a)})})</script><script src=https://0xsuk.github.io/js/viewer.min.652118a9fbf3403cdfde4026209f97ace22f9e334f0b45a33431a221b3db46a8.js integrity="sha256-ZSEYqfvzQDzf3kAmIJ+XrOIvnjNPC0WjNDGiIbPbRqg=" crossorigin=anonymous defer></script><script defer src=https://0xsuk.github.io/js/katex.min.a575e93a07f02f7e58ee9002aea3b4e75163d4fa8ea3a627e90e7fafd5c718fa.js integrity="sha256-pXXpOgfwL35Y7pACrqO051Fj1PqOo6Yn6Q5/r9XHGPo=" crossorigin=anonymous></script>
</body>
</html>